(function(e,t){var n=e.Router.extend;e.Router.extend=function(){var e=n.apply(this,arguments),r=e.prototype,i=this.prototype;t.each(["before","after"],function(e){t.defaults(r[e],i[e])});return e};t.extend(e.Router.prototype,{route:function(n,r,i){if(!t.isRegExp(n))n=this._routeToRegExp(n);if(t.isFunction(r)){i=r;r=""}if(!i)i=this[r];var s=this;var o=[];var u=[];var a=0;t.each(s.before,function(e,t){o.push({filter:t,filterFn:e})});t.each(s.after,function(e,t){u.push({filter:t,filterFn:e})});e.history.route(n,function(f){function c(e,n){var r=e[a++];if(r){var o=t.isRegExp(r.filter)?r.filter:s._routeToRegExp(r.filter);if(o.test(f)){var u=t.isFunction(r.filterFn)?r.filterFn:s[r.filterFn];u.apply(s,[f,l,function(){c(e,n)}])}else{c(e,n)}}else if(n){i.apply(s,l)}}var l=s._extractParameters(n,f);a=0;c(o,true);s.trigger.apply(s,["route:"+r].concat(l));s.trigger("route",r,l);e.history.trigger("route",s,r,l);a=0;c(u)});return this}})})(Backbone,_)